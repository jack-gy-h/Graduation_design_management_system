<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.design.dao.TaskMapper">
    <resultMap id="BaseResultMap" type="com.design.entity.Task">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="VARCHAR" property="id"/>
        <result column="topic" jdbcType="VARCHAR" property="topic"/>
        <result column="college_id" jdbcType="VARCHAR" property="collegeId"/>
        <result column="major_id" jdbcType="VARCHAR" property="majorId"/>
        <result column="type" jdbcType="VARCHAR" property="type"/>
        <result column="pattern" jdbcType="VARCHAR" property="pattern"/>
        <result column="source" jdbcType="VARCHAR" property="source"/>
        <result column="canBeChosencollegeid" jdbcType="VARCHAR" property="canbechosencollegeid"/>
        <result column="research_direction" jdbcType="VARCHAR" property="researchDirection"/>
        <result column="brief_introduction" jdbcType="VARCHAR" property="briefIntroduction"/>
        <result column="basic_requirements" jdbcType="VARCHAR" property="basicRequirements"/>
        <result column="reference_data" jdbcType="VARCHAR" property="referenceData"/>
        <result column="teacher_id" jdbcType="VARCHAR" property="teacherId"/>
        <result column="audit_status" jdbcType="VARCHAR" property="auditStatus"/>
        <result column="grade" jdbcType="VARCHAR" property="grade"/>
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="update_date" jdbcType="TIMESTAMP" property="updateDate"/>
        <result column="del_flag" jdbcType="CHAR" property="delFlag"/>
        <collection property="officeList" ofType="com.design.entity.Office">
            <id property="id" column="CanBeChosenMajor"/>
        </collection>
    </resultMap>
    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, topic, college_id, major_id, type, pattern, source, canBeChosencollegeid, research_direction,
        brief_introduction, basic_requirements, reference_data, teacher_id, audit_status,
        grade, create_date, update_date, del_flag
    </sql>
    <sql id="Base_Column_List1">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        t.*,
        tc.CanBeChosenMajor
    </sql>

    <select id="selectByExample" parameterType="com.design.entity.TaskExample" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from task
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from task
        where id = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from task
        where id = #{id,jdbcType=VARCHAR}
    </delete>
    <delete id="deleteByExample" parameterType="com.design.entity.TaskExample">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from task
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="com.design.entity.Task">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into task (id, topic, college_id,
        major_id, type, pattern,
        source, canBeChosencollegeid, research_direction,
        brief_introduction, basic_requirements, reference_data,
        teacher_id, audit_status, grade,
        create_date, update_date, del_flag
        )
        values (#{id,jdbcType=VARCHAR}, #{topic,jdbcType=VARCHAR}, #{collegeId,jdbcType=VARCHAR},
        #{majorId,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, #{pattern,jdbcType=VARCHAR},
        #{source,jdbcType=VARCHAR}, #{canbechosencollegeid,jdbcType=VARCHAR}, #{researchDirection,jdbcType=VARCHAR},
        #{briefIntroduction,jdbcType=VARCHAR}, #{basicRequirements,jdbcType=VARCHAR}, #{referenceData,jdbcType=VARCHAR},
        #{teacherId,jdbcType=VARCHAR}, #{auditStatus,jdbcType=VARCHAR}, #{grade,jdbcType=VARCHAR},
        #{createDate,jdbcType=TIMESTAMP}, #{updateDate,jdbcType=TIMESTAMP}, #{delFlag,jdbcType=CHAR}
        )
    </insert>
    <insert id="insertSelective" parameterType="com.design.entity.Task">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into task
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="topic != null">
                topic,
            </if>
            <if test="collegeId != null">
                college_id,
            </if>
            <if test="majorId != null">
                major_id,
            </if>
            <if test="type != null">
                type,
            </if>
            <if test="pattern != null">
                pattern,
            </if>
            <if test="source != null">
                source,
            </if>
            <if test="canbechosencollegeid != null">
                canBeChosencollegeid,
            </if>
            <if test="researchDirection != null">
                research_direction,
            </if>
            <if test="briefIntroduction != null">
                brief_introduction,
            </if>
            <if test="basicRequirements != null">
                basic_requirements,
            </if>
            <if test="referenceData != null">
                reference_data,
            </if>
            <if test="teacherId != null">
                teacher_id,
            </if>
            <if test="auditStatus != null">
                audit_status,
            </if>
            <if test="grade != null">
                grade,
            </if>
            <if test="createDate != null">
                create_date,
            </if>
            <if test="updateDate != null">
                update_date,
            </if>
            <if test="delFlag != null">
                del_flag,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="topic != null">
                #{topic,jdbcType=VARCHAR},
            </if>
            <if test="collegeId != null">
                #{collegeId,jdbcType=VARCHAR},
            </if>
            <if test="majorId != null">
                #{majorId,jdbcType=VARCHAR},
            </if>
            <if test="type != null">
                #{type,jdbcType=VARCHAR},
            </if>
            <if test="pattern != null">
                #{pattern,jdbcType=VARCHAR},
            </if>
            <if test="source != null">
                #{source,jdbcType=VARCHAR},
            </if>
            <if test="canbechosencollegeid != null">
                #{canbechosencollegeid,jdbcType=VARCHAR},
            </if>
            <if test="researchDirection != null">
                #{researchDirection,jdbcType=VARCHAR},
            </if>
            <if test="briefIntroduction != null">
                #{briefIntroduction,jdbcType=VARCHAR},
            </if>
            <if test="basicRequirements != null">
                #{basicRequirements,jdbcType=VARCHAR},
            </if>
            <if test="referenceData != null">
                #{referenceData,jdbcType=VARCHAR},
            </if>
            <if test="teacherId != null">
                #{teacherId,jdbcType=VARCHAR},
            </if>
            <if test="auditStatus != null">
                #{auditStatus,jdbcType=VARCHAR},
            </if>
            <if test="grade != null">
                #{grade,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updateDate != null">
                #{updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="delFlag != null">
                #{delFlag,jdbcType=CHAR},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="com.design.entity.TaskExample" resultType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select count(*) from task
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update task
        <set>
            <if test="record.id != null">
                id = #{record.id,jdbcType=VARCHAR},
            </if>
            <if test="record.topic != null">
                topic = #{record.topic,jdbcType=VARCHAR},
            </if>
            <if test="record.collegeId != null">
                college_id = #{record.collegeId,jdbcType=VARCHAR},
            </if>
            <if test="record.majorId != null">
                major_id = #{record.majorId,jdbcType=VARCHAR},
            </if>
            <if test="record.type != null">
                type = #{record.type,jdbcType=VARCHAR},
            </if>
            <if test="record.pattern != null">
                pattern = #{record.pattern,jdbcType=VARCHAR},
            </if>
            <if test="record.source != null">
                source = #{record.source,jdbcType=VARCHAR},
            </if>
            <if test="record.canbechosencollegeid != null">
                canBeChosencollegeid = #{record.canbechosencollegeid,jdbcType=VARCHAR},
            </if>
            <if test="record.researchDirection != null">
                research_direction = #{record.researchDirection,jdbcType=VARCHAR},
            </if>
            <if test="record.briefIntroduction != null">
                brief_introduction = #{record.briefIntroduction,jdbcType=VARCHAR},
            </if>
            <if test="record.basicRequirements != null">
                basic_requirements = #{record.basicRequirements,jdbcType=VARCHAR},
            </if>
            <if test="record.referenceData != null">
                reference_data = #{record.referenceData,jdbcType=VARCHAR},
            </if>
            <if test="record.teacherId != null">
                teacher_id = #{record.teacherId,jdbcType=VARCHAR},
            </if>
            <if test="record.auditStatus != null">
                audit_status = #{record.auditStatus,jdbcType=VARCHAR},
            </if>
            <if test="record.grade != null">
                grade = #{record.grade,jdbcType=VARCHAR},
            </if>
            <if test="record.createDate != null">
                create_date = #{record.createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="record.updateDate != null">
                update_date = #{record.updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="record.delFlag != null">
                del_flag = #{record.delFlag,jdbcType=CHAR},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update task
        set id = #{record.id,jdbcType=VARCHAR},
        topic = #{record.topic,jdbcType=VARCHAR},
        college_id = #{record.collegeId,jdbcType=VARCHAR},
        major_id = #{record.majorId,jdbcType=VARCHAR},
        type = #{record.type,jdbcType=VARCHAR},
        pattern = #{record.pattern,jdbcType=VARCHAR},
        source = #{record.source,jdbcType=VARCHAR},
        canBeChosencollegeid = #{record.canbechosencollegeid,jdbcType=VARCHAR},
        research_direction = #{record.researchDirection,jdbcType=VARCHAR},
        brief_introduction = #{record.briefIntroduction,jdbcType=VARCHAR},
        basic_requirements = #{record.basicRequirements,jdbcType=VARCHAR},
        reference_data = #{record.referenceData,jdbcType=VARCHAR},
        teacher_id = #{record.teacherId,jdbcType=VARCHAR},
        audit_status = #{record.auditStatus,jdbcType=VARCHAR},
        grade = #{record.grade,jdbcType=VARCHAR},
        create_date = #{record.createDate,jdbcType=TIMESTAMP},
        update_date = #{record.updateDate,jdbcType=TIMESTAMP},
        del_flag = #{record.delFlag,jdbcType=CHAR}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.design.entity.Task">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update task
        <set>
            <if test="topic != null">
                topic = #{topic,jdbcType=VARCHAR},
            </if>
            <if test="collegeId != null">
                college_id = #{collegeId,jdbcType=VARCHAR},
            </if>
            <if test="majorId != null">
                major_id = #{majorId,jdbcType=VARCHAR},
            </if>
            <if test="type != null">
                type = #{type,jdbcType=VARCHAR},
            </if>
            <if test="pattern != null">
                pattern = #{pattern,jdbcType=VARCHAR},
            </if>
            <if test="source != null">
                source = #{source,jdbcType=VARCHAR},
            </if>
            <if test="canbechosencollegeid != null">
                canBeChosencollegeid = #{canbechosencollegeid,jdbcType=VARCHAR},
            </if>
            <if test="researchDirection != null">
                research_direction = #{researchDirection,jdbcType=VARCHAR},
            </if>
            <if test="briefIntroduction != null">
                brief_introduction = #{briefIntroduction,jdbcType=VARCHAR},
            </if>
            <if test="basicRequirements != null">
                basic_requirements = #{basicRequirements,jdbcType=VARCHAR},
            </if>
            <if test="referenceData != null">
                reference_data = #{referenceData,jdbcType=VARCHAR},
            </if>
            <if test="teacherId != null">
                teacher_id = #{teacherId,jdbcType=VARCHAR},
            </if>
            <if test="auditStatus != null">
                audit_status = #{auditStatus,jdbcType=VARCHAR},
            </if>
            <if test="grade != null">
                grade = #{grade,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                create_date = #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updateDate != null">
                update_date = #{updateDate,jdbcType=TIMESTAMP},
            </if>
            <if test="delFlag != null">
                del_flag = #{delFlag,jdbcType=CHAR},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.design.entity.Task">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update task
        set topic = #{topic,jdbcType=VARCHAR},
        college_id = #{collegeId,jdbcType=VARCHAR},
        major_id = #{majorId,jdbcType=VARCHAR},
        type = #{type,jdbcType=VARCHAR},
        pattern = #{pattern,jdbcType=VARCHAR},
        source = #{source,jdbcType=VARCHAR},
        canBeChosencollegeid = #{canbechosencollegeid,jdbcType=VARCHAR},
        research_direction = #{researchDirection,jdbcType=VARCHAR},
        brief_introduction = #{briefIntroduction,jdbcType=VARCHAR},
        basic_requirements = #{basicRequirements,jdbcType=VARCHAR},
        reference_data = #{referenceData,jdbcType=VARCHAR},
        teacher_id = #{teacherId,jdbcType=VARCHAR},
        audit_status = #{auditStatus,jdbcType=VARCHAR},
        grade = #{grade,jdbcType=VARCHAR},
        create_date = #{createDate,jdbcType=TIMESTAMP},
        update_date = #{updateDate,jdbcType=TIMESTAMP},
        del_flag = #{delFlag,jdbcType=CHAR}
        where id = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateTaskChosenStatus">
        update task_chosen tc
        set tc.task_id               = #{taskid},
            tc.chosen_student        = #{studentId},
            tc.teacher_choose_status = #{status}
        where tc.task_id = #{taskid}
          AND tc.chosen_student = #{studentId}
          AND tc.teacher_choose_status = #{choosestatusId}

    </update>
    <update id="updatetaskchosen" parameterType="com.design.entity.Task">
        update task_chosen tc
        set tc.task_id               = #{id},
            tc.chosen_student        = #{studentId},
            tc.teacher_choose_status = 1
        WHERE tc.task_id = #{id}
          AND tc.chosen_student = #{studentId}
    </update>
    <delete id="deleteTaskOffice">

        DELETE
        FROM task_canbechosenmajor
        where task_id = #{id}
    </delete>
    <delete id="deletehaschosentopic">
        delete
        from task_chosen
        where chosen_student = #{userId}
          AND task_id = #{taskid}
          AND teacher_choose_status = 1


    </delete>
    <insert id="insertTaskOffice">
        INSERT INTO task_canbechosenmajor(task_id, CanBeChosenMajor)
        <foreach collection="officeList" item="office" separator="union all">

            select #{id},#{office.id}


        </foreach>

    </insert>
    <insert id="studentdoublechoose">
        INSERT INTO graduation_design_management_system.task_chosen(graduation_design_management_system.task_chosen.task_id,
                                                                    graduation_design_management_system.task_chosen.chosen_student,
                                                                    graduation_design_management_system.task_chosen.teacher_choose_status)
        values (#{taskid}, #{userId}, 1)

    </insert>
    <insert id="inserttaskchosen" parameterType="com.design.entity.Task">

        INSERT INTO task_chosen(task_id, chosen_student, teacher_choose_status)
        values (#{id}, #{studentId}, 1)


    </insert>
    <select id="getTaskById" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List1"/>
        FROM task t
        LEFT JOIN task_canbechosenmajor tc ON tc.task_id= t.id
        where t.id = #{id,jdbcType=VARCHAR}


    </select>
    <select id="getdoubletaskListByPageAndRows" resultType="com.design.entity.Task">
        SELECT
        t.id AS "id",
        t.topic AS "topic",
        co.name AS "collegeId",
        tt.type AS "type",
        ts.source AS "source",
        u.name AS "teachername",
        u.identity_number AS "teacherId",
        ma.name AS "majorname",
        tas.Audit_Status AS "auditStatus",
        t.create_date AS "createDate",
        tas.id AS "auditStatusId"
        FROM task t
        LEFT JOIN office co ON t.college_id = co.id
        LEFT JOIN office ma ON t.major_id = ma.id
        LEFT JOIN USER u ON t.teacher_id = u.id
        LEFT JOIN task_type tt ON t.type = tt.id
        LEFT JOIN task_source ts ON t.source = ts.id
        LEFT JOIN task_audit_status tas ON tas.id = t.audit_status
        WHERE t.grade = #{grade}
        AND t.teacher_id = #{userId}
        <if test="office != 0">
            <if test="office!=null">
                AND t.college_id = #{office}
            </if>

        </if>
        <if test="topic != null">
            AND t.topic LIKE '%${topic}%'
        </if>
        <if test="teacher != null">
            AND u.name LIKE '%${teacher}%'
        </if>
        <if test="teacheridentitynumber != null">
            AND u.identity_number LIKE '%${teacheridentitynumber}%'
        </if>
        <if test="type != 0">
            <if test="type!=null">
                AND t.type = #{type}
            </if>
        </if>
        <if test="source != 0">
            <if test="source!=null">
                AND t.source = #{source}
            </if>

        </if>
        AND t.del_Flag = 0
        And t.pattern = 1
        LIMIT #{page,jdbcType=INTEGER},#{rows,jdbcType=INTEGER}


    </select>

    <select id="getdoubletaskListCountByPageAndRows" resultType="java.lang.Integer">
        select count(*)
        FROM task t
        LEFT JOIN USER u ON t.teacher_id = u.id

        WHERE t.grade = #{grade}
        AND t.teacher_id = #{userId}
        <if test="office != 0">
            <if test="office!=null">
                AND t.college_id = #{office}
            </if>

        </if>
        <if test="topic != null">
            AND t.topic LIKE '%${topic}%'
        </if>
        <if test="teacher != null">
            AND u.name LIKE '%${teacher}%'
        </if>
        <if test="teacheridentitynumber != null">
            AND u.identity_number LIKE '%${teacheridentitynumber}%'
        </if>
        <if test="type != 0">
            <if test="type!=null">
                AND t.type = #{type}
            </if>
        </if>
        <if test="source != 0">
            <if test="source!=null">
                AND t.source = #{source}
            </if>

        </if>
        AND t.del_Flag = 0
        And t.pattern = 1


    </select>
    <select id="getTaskTotalInformationById" resultType="com.design.entity.Task">
        SELECT t.id                 AS "id",
               t.topic              AS "topic",
               co.name              AS "collegename",
               ma.name              AS "majorname",
               tt.type              AS "typename",
               ts.source            AS "sourcename",
               tc.canbechosentype   AS "canbechosentypename",
               t.research_direction AS "researchDirection",
               t.brief_introduction AS "briefIntroduction",
               t.basic_requirements AS "basicRequirements",
               t.reference_data     AS "referenceData"
        FROM task t
                 LEFT JOIN office co ON co.id = t.college_id
                 LEFT JOIN office ma ON ma.id = t.major_id
                 LEFT JOIN task_type tt ON tt.id = t.type
                 LEFT JOIN task_source ts ON ts.id = t.source
                 LEFT JOIN task_canbechosentype tc ON tc.id = t.canBeChosencollegeid

        WHERE t.del_flag = 0
          AND t.id = #{id}


    </select>
    <select id="getdoubletaskListByPageAndRowsForAuditDouble" resultType="com.design.entity.Task">
        SELECT t.id              AS "id",
               t.topic           AS "topic",
               tt.type           AS "type",
               ts.source         AS "source",
               u.name            AS "teachername",
               u.identity_number AS "teacherId",
               tas.Audit_Status  AS "auditStatus",
               t.create_date     AS "createDate",
               tas.id            AS "auditStatusId"
        FROM task t
                 LEFT JOIN USER u ON t.teacher_id = u.id
                 LEFT JOIN task_type tt ON t.type = tt.id
                 LEFT JOIN task_source ts ON t.source = ts.id
                 LEFT JOIN task_audit_status tas ON tas.id = t.audit_status
        WHERE t.grade = #{grade}
          AND t.major_id = #{majorid}

          AND t.del_Flag = 0
          AND t.pattern = 1
          AND t.audit_status = 3
    </select>
    <select id="getdoubletaskListCountByPageAndRowsForAuditDouble" resultType="java.lang.Integer">
        select count(*)
        FROM task t
        WHERE t.grade = #{grade}
          AND t.major_id = #{majorid}

          AND t.del_Flag = 0
          AND t.pattern = 1
          AND t.audit_status = 3


    </select>
    <select id="getstudentdoubletaskListByPageAndRows" resultType="com.design.entity.Task">
        select t.id AS "id",
        t.topic AS "topic",
        co.name AS "collegeId",
        tt.type AS "type",
        ts.source AS "source",
        u.name AS "teachername",
        u.identity_number AS "teacherId",
        ma.name AS "majorname",
        t.create_date AS "createDate"
        FROM task t
        LEFT JOIN office co ON t.college_id = co.id
        LEFT JOIN task_type tt on t.type = tt.id
        LEFT JOIN task_source ts on t.source = ts.id
        LEFT JOIN user u ON t.teacher_id = u.id
        LEFT JOIN Office ma ON ma.id = t.major_id
        LEFT JOIN task_canbechosenmajor tc on t.id = tc.task_id
        WHERE tc.CanBeChosenMajor = #{majorid}
        AND t.grade = #{grade}
        AND t.audit_status = 1
        AND t.pattern = 1
        AND t.del_flag = 0
        <if test="office != 0">
            <if test="office!=null">
                AND t.college_id = #{office}
            </if>

        </if>
        <if test="topic != null">
            AND t.topic LIKE '%${topic}%'
        </if>
        <if test="teacher != null">
            AND u.name LIKE '%${teacher}%'
        </if>
        <if test="teacheridentitynumber != null">
            AND u.identity_number LIKE '%${teacheridentitynumber}%'
        </if>
        <if test="type != 0">
            <if test="type!=null">
                AND t.type = #{type}
            </if>
        </if>
        <if test="source != 0">
            <if test="source!=null">
                AND t.source = #{source}
            </if>

        </if>
        LIMIT #{page,jdbcType=INTEGER},#{rows,jdbcType=INTEGER}

    </select>
    <select id="getstudentdoubletaskListCountByPageAndRows" resultType="java.lang.Integer">
        select count(*)
        FROM task t
        LEFT JOIN task_canbechosenmajor tc on t.id = tc.task_id
        LEFT JOIN user u ON t.teacher_id = u.id
        LEFT JOIN graduation_design_management_system.task_chosen tch ON tch.task_id = t.id
        WHERE tc.CanBeChosenMajor = #{majorid}
        AND t.grade = #{grade}
        AND t.audit_status = 1
        AND t.pattern = 1
        AND t.del_flag = 0
        AND (tch.teacher_choose_status != 2 or tch.teacher_choose_status is null)
        <if test="office != 0">
            <if test="office!=null">
                AND t.college_id = #{office}
            </if>

        </if>
        <if test="topic != null">
            AND t.topic LIKE '%${topic}%'
        </if>
        <if test="teacher != null">
            AND u.name LIKE '%${teacher}%'
        </if>
        <if test="teacheridentitynumber != null">
            AND u.identity_number LIKE '%${teacheridentitynumber}%'
        </if>
        <if test="type != 0">
            <if test="type!=null">
                AND t.type = #{type}
            </if>
        </if>
        <if test="source != 0">
            <if test="source!=null">
                AND t.source = #{source}
            </if>

        </if>


    </select>
    <select id="getviewlogDatafordoubletaskByPageAndRows" resultType="com.design.entity.Task">
        select u.name        AS "operator",
               r.name        AS "operatorRole",
               l.lAction     AS "action",
               l.lRemark     AS "remark",
               l.lCreatetime AS "createtime"

        from graduation_design_management_system.log l
                 LEFT JOIN user u ON l.lCreator = u.id
                 LEFT JOIN role r ON r.id = l.lCreatorRole
        WHERE l.lTask = #{taskid}
        LIMIT #{page,jdbcType=INTEGER},#{rows,jdbcType=INTEGER}


    </select>
    <select id="getviewlogDatafordoubletaskCountByPageAndRows" resultType="java.lang.Integer">
        select count(*)
        from graduation_design_management_system.log l
        WHERE l.lTask = #{taskid}


    </select>
    <select id="gettaskstudentjudgehaschosen" resultType="java.lang.Integer">
        select count(*)
        FROM graduation_design_management_system.task_chosen tc
        WHERE tc.chosen_student = #{userId}
          AND tc.teacher_choose_status = 2


    </select>
    <select id="gettaskstudentjudgehaschosenThreeTitle" resultType="java.lang.Integer">
        select count(chosen_student)
        FROM graduation_design_management_system.task_chosen tc
        WHERE tc.chosen_student = #{userId}
          AND tc.teacher_choose_status = 1


    </select>
    <select id="gettaskstudentjudgehaschosenThreePeople" resultType="java.lang.Integer">

        select count(*)
        FROM graduation_design_management_system.task_chosen tc
        WHERE tc.task_id = #{taskid}
          AND tc.teacher_choose_status = 1
    </select>
    <select id="gettaskstudentjudgewhetherchoosethistask" resultType="java.lang.Integer">

        select count(*)
        FROM graduation_design_management_system.task_chosen tc
        WHERE tc.task_id = #{taskid}
          AND tc.chosen_student = #{userId}
          AND tc.teacher_choose_status = 1
    </select>
    <select id="gettaskstudenthaschosendoubletaskListDataByPageAndRows" resultType="com.design.entity.Task">
        select t.id                       AS "id",
               t.topic                    AS "topic",
               tt.type                    AS "type",
               ts.source                  AS "source",
               u.name                     AS "teachername",
               u.identity_number          AS "teacherId",
               ttcs.teacher_choose_status AS "teacherchoosestatus",
               ttcs.id                    AS "teacherchoosestatusId"
        FROM task t
                 LEFT JOIN task_chosen tc ON tc.task_id = t.id
                 LEFT JOIN USER u ON t.teacher_id = u.id
                 LEFT JOIN task_type tt ON t.type = tt.id
                 LEFT JOIN task_source ts ON t.source = ts.id
                 LEFT JOIN task_teacher_choose_status ttcs ON ttcs.id = tc.teacher_choose_status
        WHERE tc.chosen_student = #{userId}
        LIMIT #{page,jdbcType=INTEGER},#{rows,jdbcType=INTEGER}


    </select>
    <select id="gettaskstudenthaschosendoubletaskListDataCountByPageAndRows" resultType="java.lang.Integer">
        select count(*)
        FROM task t
                 LEFT JOIN task_chosen tc ON tc.task_id = t.id

        WHERE tc.chosen_student = #{userId}


    </select>
    <select id="getviewchosenstudentallListData" resultType="com.design.entity.Task">
        SELECT t.id                       AS 'id',
               t.topic                    AS 'topic',
               u.`name`                   AS 'studentname',
               ttcs.teacher_choose_status AS 'teacherchoosestatus',
               ttcs.id                    AS 'teacherchoosestatusId',
               u.id                       AS 'studentId'
        FROM task t
                 LEFT JOIN task_chosen tc ON tc.task_id = t.id
                 LEFT JOIN user u ON tc.chosen_student = u.id
                 LEFT JOIN task_teacher_choose_status ttcs ON tc.teacher_choose_status = ttcs.id
        WHERE t.teacher_id = #{userId}
          AND tc.teacher_choose_status is not null
          AND t.grade = #{grade}
          AND t.pattern = 1
        LIMIT #{page,jdbcType=INTEGER},#{rows,jdbcType=INTEGER}


    </select>
    <select id="getviewchosenstudentallListDataCountByPageAndRows" resultType="java.lang.Integer">
        select count(*)
        FROM task t
                 LEFT JOIN task_chosen tc ON tc.task_id = t.id
        WHERE t.teacher_id = #{userId}
          AND tc.teacher_choose_status is not null
          AND t.grade = #{grade}
          AND t.pattern = 1

    </select>
    <select id="gettaskstudentreleasetaskListData" resultType="com.design.entity.Task">
        SELECT t.id                       AS "id",
               t.topic                    AS "topic",
               co.NAME                    AS "collegeId",
               tt.type                    AS "type",
               ts.source                  AS "source",
               u.NAME                     AS "teachername",
               u.identity_number          AS "teacherId",
               ma.NAME                    AS "majorname",
               ttcs.teacher_choose_status AS "teacherchoosestatus",
               ttcs.id                    AS "teacherchoosestatusId",
               t.create_date              AS "createDate"
        FROM task t
                 LEFT JOIN office co ON t.college_id = co.id
                 LEFT JOIN task_type tt ON tt.id = t.type
                 LEFT JOIN task_source ts ON ts.id = t.source
                 LEFT JOIN task_chosen tc ON t.id = tc.task_id
                 LEFT JOIN task_teacher_choose_status ttcs ON ttcs.id = tc.teacher_choose_status
                 LEFT JOIN `user` u ON t.teacher_id = u.id
                 LEFT JOIN office ma ON t.major_id = ma.id
        WHERE tc.chosen_student = #{userId}
          AND t.grade = #{grade}
          AND t.pattern = 3
          AND t.del_flag = 0
        LIMIT #{page},#{rows}

    </select>
    <select id="getTaskForstudentchoosemodifyById" resultType="com.design.entity.Task">
        SELECT t.id                 AS "id",
               t.pattern            AS "pattern",
               t.topic              AS "topic",
               t.college_id         AS "collegeId",
               co.name              AS "collegename",
               t.major_id           AS "majorId",
               ma.`name`            AS "majorname",
               t.teacher_id         AS "teacherId",
               u.`name`             AS "teachername",
               t.type               AS "type",
               t.source             AS "source",
               t.research_direction AS "researchDirection",
               t.brief_introduction AS "briefIntroduction",
               t.basic_requirements AS "basicRequirements",
               t.reference_data     AS "referenceData",
               t.grade              AS "grade",
               t.create_date        AS "createDate"
        FROM task t
                 LEFT JOIN office co ON co.id = t.college_id
                 LEFT JOIN office ma ON ma.id = t.major_id
                 LEFT JOIN user u ON u.id = t.teacher_id
        WHERE t.id = #{id}
    </select>
    <select id="gettaskviewauditstudentreleaseListData" resultType="com.design.entity.Task">
        SELECT t.id                       AS "id",
               t.topic                    AS "topic",
               u.name                     AS "studentname",
               ttcs.teacher_choose_status AS "teacherchoosestatus",
               ttcs.id                    AS "teacherchoosestatusId",
               u.id AS "studentId"


        FROM task t
                 LEFT JOIN task_chosen tc ON tc.task_id = t.id
                 LEFT JOIN user u ON u.id = tc.chosen_student
                 LEFT JOIN task_teacher_choose_status ttcs ON ttcs.id = tc.teacher_choose_status
        WHERE t.pattern = 3
          AND t.teacher_id = #{userId}
          AND t.del_flag = 0
        LIMIT #{page},#{rows}


    </select>

</mapper>